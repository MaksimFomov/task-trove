# Алгоритм публикации заказа

## Описание процесса

Алгоритм описывает полный процесс публикации заказа в системе Task Trove, начиная с момента выбора пользователем создания заказа и заканчивая получением уведомления о решении администратора.

---

## Блок-схема алгоритма

### 1. Начало
**Форма:** Овал  
**Действие:** Начало процесса публикации заказа

---

### 2. Пользователь выбирает создать заказ
**Форма:** Параллелограмм  
**Действие:** Пользователь (заказчик) переходит на страницу создания заказа или нажимает кнопку "Создать заказ"

---

### 3. Пользователь авторизован?
**Форма:** Ромб (решение)  
**Условие:** Система проверяет наличие активной сессии пользователя с ролью "Customer" (проверка происходит через ProtectedRoute)

**Если НЕТ:**
- Переход к шагу 4

**Если ДА:**
- Переход к шагу 5

---

### 4. Перенаправление на страницу входа/регистрации
**Форма:** Параллелограмм  
**Действие:** Система перенаправляет пользователя на страницу входа для авторизации

**После авторизации:**
- Переход к шагу 5

---

### 5. Система открывает форму создания заказа
**Форма:** Прямоугольник  
**Действие:** Система отображает форму с полями для ввода данных заказа:
- Название заказа (обязательное, 3-200 символов)
- Описание заказа (обязательное, 10-5000 символов)
- Область деятельности (обязательное, выбор из списка чекбоксов)
- Технологии/стек (опциональное, до 500 символов)

---

### 6. Пользователь вводит данные заказа
**Форма:** Параллелограмм  
**Действие:** Пользователь заполняет все необходимые поля формы создания заказа

---

### 7. Пользователь нажимает "Создать заказ"
**Форма:** Параллелограмм  
**Действие:** Пользователь подтверждает заявку, нажимая кнопку отправки формы

---

### 8. Система проверяет корректность введённых данных
**Форма:** Прямоугольник  
**Действие:** Система выполняет валидацию данных на клиенте:
- Проверка заполненности обязательных полей
- Проверка длины названия (минимум 3, максимум 200 символов)
- Проверка длины описания (минимум 10, максимум 5000 символов)
- Проверка выбора хотя бы одной области деятельности
- Проверка длины поля технологий (максимум 500 символов, если заполнено)

---

### 9. Данные корректны?
**Форма:** Ромб (решение)  
**Условие:** Результат валидации данных

**Если НЕТ:**
- Переход к шагу 10

**Если ДА:**
- Переход к шагу 11

---

### 10. Система отображает сообщение об ошибке и предлагает исправить данные
**Форма:** Параллелограмм  
**Действие:** Система показывает пользователю сообщения об ошибках валидации для каждого некорректного поля и предлагает исправить данные

**После исправления:**
- Возврат к шагу 6

---

### 11. Система сохраняет заказ и устанавливает статус "На рассмотрении" (ON_REVIEW)
**Форма:** Прямоугольник  
**Действие:** Система выполняет следующие операции:
- Создаёт запись заказа в базе данных
- Устанавливает статус заказа: `ON_REVIEW`
- Устанавливает время публикации: текущее время (OffsetDateTime.now())
- Связывает заказ с заказчиком
- Инициализирует счётчик откликов (replyBind): 0
- Исполнитель (performer) устанавливается как null

---

### 12. Система отправляет уведомления всем администраторам о новом заказе на рассмотрении
**Форма:** Прямоугольник  
**Действие:** Система:
- Находит всех пользователей с ролями "Administrator" и "SuperAdministrator"
- Создаёт уведомление типа "ORDER_REVIEW" для каждого администратора
- Уведомление содержит: название заказа, имя заказчика, ID заказа, ID заказчика

---

### 13. Система перенаправляет пользователя на страницу заказов и отображает сообщение об успехе
**Форма:** Параллелограмм  
**Действие:** Система:
- Отображает сообщение "Заказ отправлен на рассмотрение"
- Перенаправляет пользователя на страницу `/customer/orders`
- Обновляет список заказов в интерфейсе

---

### 14. Администратор получает уведомление о новом заказе на рассмотрении
**Форма:** Параллелограмм  
**Действие:** Администратор видит уведомление в системе о новом заказе, требующем проверки и одобрения

---

### 15. Администратор проверяет заказ
**Форма:** Прямоугольник  
**Действие:** Администратор просматривает детали заказа в административной панели:
- Название заказа
- Описание заказа
- Область деятельности
- Технологии
- Информацию о заказчике
- Время создания заказа

---

### 16. Заявка одобрена администратором?
**Форма:** Ромб (решение)  
**Условие:** Решение администратора об одобрении или отклонении заказа

**Если НЕТ:**
- Переход к шагу 17

**Если ДА:**
- Переход к шагу 18

---

### 17. Система устанавливает статус "Отклонено" (REJECTED) и отправляет уведомление заказчику о причине
**Форма:** Прямоугольник  
**Действие:** Система:
- Изменяет статус заказа на `REJECTED`
- Сохраняет заказ в базе данных
- Создаёт уведомление типа "ORDER_REJECTED" для заказчика
- Уведомление содержит: название заказа, причину отклонения (если указана администратором)

**После выполнения:**
- Переход к шагу 20

---

### 18. Система устанавливает статус "Активен" (ACTIVE) и отправляет уведомление заказчику
**Форма:** Прямоугольник  
**Действие:** Система:
- Изменяет статус заказа на `ACTIVE`
- Сохраняет заказ в базе данных
- Создаёт уведомление типа "ORDER_APPROVED" для заказчика
- Уведомление содержит: название заказа, информацию о том, что заказ доступен для исполнителей

---

### 19. Заказчик получает уведомление о решении: заказ одобрен и доступен для исполнителей
**Форма:** Параллелограмм  
**Действие:** Заказчик получает уведомление о том, что его заказ одобрен администратором и теперь виден исполнителям в системе. Заказчик может ожидать откликов от исполнителей.

**После получения уведомления:**
- Переход к шагу 21

---

### 20. Заказчик получает уведомление о решении: заказ отклонён с указанием причины
**Форма:** Параллелограмм  
**Действие:** Заказчик получает уведомление о том, что его заказ не прошёл проверку администратором. В уведомлении указана причина отклонения (если она была указана). Заказчик может исправить заказ и отправить его на повторную проверку.

**После получения уведомления:**
- Переход к шагу 21

---

### 21. Конец
**Форма:** Овал  
**Действие:** Завершение процесса публикации заказа

---

## Статусы заказа

- **ON_REVIEW** - Заказ на рассмотрении (ожидает проверки администратором)
- **ACTIVE** - Заказ активен и доступен для откликов исполнителей
- **REJECTED** - Заказ отклонён администратором
- **IN_PROCESS** - Заказ в работе (назначен исполнитель)
- **ON_CHECK** - Заказ на проверке
- **DONE** - Заказ выполнен

---

## Дополнительные сценарии

### Сценарий: Повторная отправка отклонённого заказа
Если заказ был отклонён (статус `REJECTED`), заказчик может:
1. Отредактировать данные заказа
2. Отправить заказ на повторную проверку
3. Статус заказа снова меняется на `ON_REVIEW`
4. Администраторы получают уведомление о повторной отправке заказа

---

## Примечания

- Все уведомления сохраняются в базе данных и отображаются в интерфейсе пользователя
- Заказчик может видеть статус своего заказа в личном кабинете
- Администратор может просматривать все заказы на рассмотрении в административной панели
- После одобрения заказ становится видимым для всех исполнителей в системе
- Отклонённые заказы могут быть отредактированы и отправлены на повторную проверку

