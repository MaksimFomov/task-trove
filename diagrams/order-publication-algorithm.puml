@startuml Алгоритм публикации заказа
!theme plain
skinparam backgroundColor #FFFFFF
skinparam defaultFontName "Arial"
skinparam defaultFontSize 12
skinparam activity {
  BackgroundColor #E8F4F8
  BorderColor #0066CC
  FontColor #000000
}
skinparam arrow {
  Color #0066CC
}

start

:Начало;

:Получение заказчика\nпо accountId из БД;

if (Заказчик найден?) then (нет)
  :Выброс исключения:\n"Customer not found";
  stop
else (да)
endif

:Маппинг DTO в Entity\n(Orders);
note right
  Преобразование AddOrderDto
  в объект Orders
  Поля:
  - title
  - scope
  - description
  - stackS (techStack)
end note

:Установка заказчика\nдля заказа;
note right: order.setCustomer(customer)

:Установка исполнителя = null;
note right: order.setPerformer(null)

:Установка статуса заказа\nна "На рассмотрении";
note right: order.setStatus(ON_REVIEW)

:Установка времени публикации;
note right: order.setPublicationTime(now())

if (replyBind == null?) then (да)
  :Установка replyBind = 0;
else (нет)
endif

:Сохранение заказа в БД;
note right: ordersService.save(order)

:Извлечение всех аккаунтов\nс ролями из БД;

:Перебор аккаунтов\ni=0, i<N, i++;

repeat
  if (У аккаунта есть роль?) then (да)
    if (Роль = Administrator\nили SuperAdministrator?) then (да)
      :Формирование данных\nдля уведомления;
      note right
        orderTitle
        customerName
        orderId
        customerId
      end note
      
      :Создание уведомления\nдля администратора;
      note right: Уведомление о новом\nзаказе на рассмотрении
    else (нет)
    endif
  else (нет)
  endif
repeat while (Есть еще аккаунты?) is (да)
->нет;

:Конец;

stop

@enduml

